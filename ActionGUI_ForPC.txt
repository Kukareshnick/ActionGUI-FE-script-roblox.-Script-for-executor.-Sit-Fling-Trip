local Player = game.Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

-- FLING --
local FLING_FORCE = 120
local FLING_DOWNWARD_FORCE = 30
local FLING_DURATION = 0.5
local FLING_SPIN_SPEED = 80
-- FLING --

-- TRIP --
local TRIP_DURATION = 3
local TRIP_SPIN_SPEED = 5
-- TRIP --

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ActionGUI"
ScreenGui.ResetOnSpawn = false

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 300, 0, 200)
MainFrame.Position = UDim2.new(0.5, -150, 0.5, -100)
MainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
MainFrame.BorderSizePixel = 0
MainFrame.ClipsDescendants = true

local DragFrame = Instance.new("Frame")
DragFrame.Name = "DragFrame"
DragFrame.Size = UDim2.new(1, 0, 0, 30)
DragFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
DragFrame.BorderSizePixel = 0

local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Size = UDim2.new(1, -60, 1, 0)
Title.Position = UDim2.new(0, 5, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "Action Panel"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 14
Title.TextXAlignment = Enum.TextXAlignment.Left

local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Name = "MinimizeButton"
MinimizeButton.Size = UDim2.new(0, 25, 0, 25)
MinimizeButton.Position = UDim2.new(1, -55, 0, 2)
MinimizeButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
MinimizeButton.BorderSizePixel = 0
MinimizeButton.Text = "_"
MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizeButton.Font = Enum.Font.GothamBold
MinimizeButton.TextSize = 18

local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 25, 0, 25)
CloseButton.Position = UDim2.new(1, -25, 0, 2)
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
CloseButton.BorderSizePixel = 0
CloseButton.Text = "×"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.TextSize = 20

local ButtonsFrame = Instance.new("Frame")
ButtonsFrame.Name = "ButtonsFrame"
ButtonsFrame.Size = UDim2.new(1, -20, 1, -50)
ButtonsFrame.Position = UDim2.new(0, 10, 0, 40)
ButtonsFrame.BackgroundTransparency = 1

local SitButton = Instance.new("TextButton")
SitButton.Name = "SitButton"
SitButton.Size = UDim2.new(1, 0, 0, 40)
SitButton.Position = UDim2.new(0, 0, 0, 0)
SitButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
SitButton.BorderSizePixel = 0
SitButton.Text = "SIT (Key: E)"
SitButton.TextColor3 = Color3.fromRGB(255, 255, 255)
SitButton.Font = Enum.Font.Gotham
SitButton.TextSize = 14

local TripButton = Instance.new("TextButton")
TripButton.Name = "TripButton"
TripButton.Size = UDim2.new(1, 0, 0, 40)
TripButton.Position = UDim2.new(0, 0, 0, 50)
TripButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
TripButton.BorderSizePixel = 0
TripButton.Text = "TRIP (Key: R)"
TripButton.TextColor3 = Color3.fromRGB(255, 255, 255)
TripButton.Font = Enum.Font.Gotham
TripButton.TextSize = 14

local FlingButton = Instance.new("TextButton")
FlingButton.Name = "FlingButton"
FlingButton.Size = UDim2.new(1, 0, 0, 40)
FlingButton.Position = UDim2.new(0, 0, 0, 100)
FlingButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
FlingButton.BorderSizePixel = 0
FlingButton.Text = "FLING (Key: F)"
FlingButton.TextColor3 = Color3.fromRGB(255, 255, 255)
FlingButton.Font = Enum.Font.Gotham
FlingButton.TextSize = 14

local MinimizedFrame = Instance.new("Frame")
MinimizedFrame.Name = "MinimizedFrame"
MinimizedFrame.Size = UDim2.new(0, 40, 0, 40)
MinimizedFrame.Position = MainFrame.Position
MinimizedFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
MinimizedFrame.BorderSizePixel = 0
MinimizedFrame.Visible = false

local RestoreButton = Instance.new("TextButton")
RestoreButton.Name = "RestoreButton"
RestoreButton.Size = UDim2.new(1, 0, 1, 0)
RestoreButton.BackgroundTransparency = 1
RestoreButton.Text = "☰"
RestoreButton.TextColor3 = Color3.fromRGB(255, 255, 255)
RestoreButton.Font = Enum.Font.GothamBold
RestoreButton.TextSize = 24

Title.Parent = DragFrame
MinimizeButton.Parent = DragFrame
CloseButton.Parent = DragFrame
DragFrame.Parent = MainFrame
SitButton.Parent = ButtonsFrame
TripButton.Parent = ButtonsFrame
FlingButton.Parent = ButtonsFrame
ButtonsFrame.Parent = MainFrame
MainFrame.Parent = ScreenGui
RestoreButton.Parent = MinimizedFrame
MinimizedFrame.Parent = ScreenGui
ScreenGui.Parent = PlayerGui

local Keybinds = {
	Sit = "E",
	Trip = "R",
	Fling = "F"
}

local function getCharacter()
	local character = Player.Character
	if character then
		local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
		local humanoid = character:FindFirstChild("Humanoid")
		if humanoidRootPart and humanoid then
			return character, humanoidRootPart, humanoid
		end
	end
	return nil, nil, nil
end

local function sit()
	local character, humanoidRootPart, humanoid = getCharacter()
	if character and humanoid then
		humanoid.Sit = not humanoid.Sit
	end
end

local isTripped = false

local function trip()
	local character, humanoidRootPart, humanoid = getCharacter()
	if character and humanoidRootPart and humanoid and humanoid.Health > 0 then
		if isTripped then
			humanoid.PlatformStand = false
			isTripped = false

			for _, child in ipairs(humanoidRootPart:GetChildren()) do
				if child:IsA("BodyVelocity") or child:IsA("BodyAngularVelocity") then
					child:Destroy()
				end
			end
		else
			humanoid.PlatformStand = true
			isTripped = true

			local bodyVelocity = Instance.new("BodyVelocity")
			bodyVelocity.MaxForce = Vector3.new(0, 0, 0)
			bodyVelocity.Velocity = Vector3.new(0, 0, 0)
			bodyVelocity.Parent = humanoidRootPart

			local bodyAngularVelocity = Instance.new("BodyAngularVelocity")
			bodyAngularVelocity.MaxTorque = Vector3.new(1000, 1000, 1000)
			bodyAngularVelocity.AngularVelocity = Vector3.new(
				math.random(-TRIP_SPIN_SPEED, TRIP_SPIN_SPEED),
				math.random(-TRIP_SPIN_SPEED, TRIP_SPIN_SPEED),
				math.random(-TRIP_SPIN_SPEED, TRIP_SPIN_SPEED)
			)
			bodyAngularVelocity.Parent = humanoidRootPart

			task.delay(TRIP_DURATION, function()
				if humanoid and humanoid.Parent then
					humanoid.PlatformStand = false
					isTripped = false

					if bodyVelocity and bodyVelocity.Parent then
						bodyVelocity:Destroy()
					end
					if bodyAngularVelocity and bodyAngularVelocity.Parent then
						bodyAngularVelocity:Destroy()
					end
				end
			end)
		end
	end
end

local function fling()
	local character, humanoidRootPart, humanoid = getCharacter()
	if character and humanoidRootPart and humanoid and humanoid.Health > 0 then
		if isTripped then
			humanoid.PlatformStand = false
			isTripped = false

			for _, child in ipairs(humanoidRootPart:GetChildren()) do
				if child:IsA("BodyVelocity") or child:IsA("BodyAngularVelocity") then
					child:Destroy()
				end
			end
		end

		humanoid.PlatformStand = true
		local forwardDirection = humanoidRootPart.CFrame.LookVector
		
		local bodyVelocity = Instance.new("BodyVelocity")
		bodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
		bodyVelocity.Velocity = (forwardDirection * FLING_FORCE) + Vector3.new(0, -FLING_DOWNWARD_FORCE, 0)
		bodyVelocity.Parent = humanoidRootPart

		local bodyAngularVelocity = Instance.new("BodyAngularVelocity")
		bodyAngularVelocity.MaxTorque = Vector3.new(math.huge, math.huge, math.huge)
		bodyAngularVelocity.AngularVelocity = Vector3.new(
			math.random(-FLING_SPIN_SPEED, FLING_SPIN_SPEED),
			math.random(-FLING_SPIN_SPEED, FLING_SPIN_SPEED),
			math.random(-FLING_SPIN_SPEED, FLING_SPIN_SPEED)
		)
		bodyAngularVelocity.Parent = humanoidRootPart

		game:GetService("Debris"):AddItem(bodyVelocity, FLING_DURATION)
		game:GetService("Debris"):AddItem(bodyAngularVelocity, FLING_DURATION)

		task.delay(FLING_DURATION + 0.5, function()
			if humanoid and humanoid.Parent then
				humanoid.PlatformStand = false
			end
		end)
	end
end

local function updateButtonText()
	SitButton.Text = "SIT (Key: " .. Keybinds.Sit .. ")"
	TripButton.Text = "TRIP (Key: " .. Keybinds.Trip .. ")"
	FlingButton.Text = "FLING (Key: " .. Keybinds.Fling .. ")"
	if isTripped then
		TripButton.Text = "UNTRIP (Key: R)"
	end
end

local function rebindKey(action)
	local oldKey = Keybinds[action]

	if action == "Sit" then
		SitButton.Text = "Press any key..."
	elseif action == "Trip" then
		TripButton.Text = "Press any key..."
	elseif action == "Fling" then
		FlingButton.Text = "Press any key..."
	end

	local connection
	connection = UserInputService.InputBegan:Connect(function(input, gameProcessed)
		if not gameProcessed then
			if input.UserInputType == Enum.UserInputType.Keyboard then
				local newKey = input.KeyCode.Name

				for actionName, key in pairs(Keybinds) do
					if key == newKey and actionName ~= action then
						local button
						if actionName == "Sit" then
							button = SitButton
						elseif actionName == "Trip" then
							button = TripButton
						elseif actionName == "Fling" then
							button = FlingButton
						end

						local originalColor = button.BackgroundColor3
						for i = 1, 3 do
							button.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
							task.wait(0.1)
							button.BackgroundColor3 = originalColor
							task.wait(0.1)
						end
						return
					end
				end

				Keybinds[action] = newKey
				updateButtonText()
				connection:Disconnect()
			end
		end
	end)
end

local function smoothMinimize()
	local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
	
	local minimizeTween = TweenService:Create(MainFrame, tweenInfo, {
		Size = UDim2.new(0, 0, 0, 0),
		Position = UDim2.new(0, MainFrame.AbsolutePosition.X + 150, 0, MainFrame.AbsolutePosition.Y + 100)
	})
	
	minimizeTween:Play()
	minimizeTween.Completed:Wait()
	
	MainFrame.Visible = false
	MinimizedFrame.Position = UDim2.new(0, MainFrame.AbsolutePosition.X, 0, MainFrame.AbsolutePosition.Y)
	MinimizedFrame.Visible = true
	
	local restoreTween = TweenService:Create(MinimizedFrame, tweenInfo, {
		Size = UDim2.new(0, 40, 0, 40)
	})
	restoreTween:Play()
end

local function smoothRestore()
	local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
	
	local minimizeTween = TweenService:Create(MinimizedFrame, tweenInfo, {
		Size = UDim2.new(0, 0, 0, 0),
		Position = UDim2.new(0, MinimizedFrame.AbsolutePosition.X + 20, 0, MinimizedFrame.AbsolutePosition.Y + 20)
	})
	
	minimizeTween:Play()
	minimizeTween.Completed:Wait()
	
	MinimizedFrame.Visible = false
	MainFrame.Position = UDim2.new(0, MinimizedFrame.AbsolutePosition.X - 150, 0, MinimizedFrame.AbsolutePosition.Y - 100)
	MainFrame.Size = UDim2.new(0, 0, 0, 0)
	MainFrame.Visible = true
	
	local restoreTween = TweenService:Create(MainFrame, tweenInfo, {
		Size = UDim2.new(0, 300, 0, 200),
		Position = UDim2.new(0, MinimizedFrame.AbsolutePosition.X - 150, 0, MinimizedFrame.AbsolutePosition.Y - 100)
	})
	restoreTween:Play()
end

local function smoothClose()
	local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
	
	local closeTween = TweenService:Create(MainFrame, tweenInfo, {
		Size = UDim2.new(0, 0, 0, 0),
		Position = UDim2.new(0, MainFrame.AbsolutePosition.X + 150, 0, MainFrame.AbsolutePosition.Y + 100),
		BackgroundTransparency = 1
	})
	
	closeTween:Play()
	closeTween.Completed:Wait()
	ScreenGui:Destroy()
end

MinimizeButton.MouseButton1Click:Connect(function()
	smoothMinimize()
end)

CloseButton.MouseButton1Click:Connect(function()
	smoothClose()
end)

RestoreButton.MouseButton1Click:Connect(function()
	smoothRestore()
end)

SitButton.MouseButton1Click:Connect(function()
	if not SitButton:IsDescendantOf(game) then return end
	local clickTime = tick()
	SitButton.Activated = clickTime
	task.wait(0.01)
	if SitButton.Activated == clickTime then
		sit()
	end
end)

SitButton.MouseButton2Click:Connect(function()
	rebindKey("Sit")
end)

TripButton.MouseButton1Click:Connect(function()
	if not TripButton:IsDescendantOf(game) then return end
	local clickTime = tick()
	TripButton.Activated = clickTime
	task.wait(0.01)
	if TripButton.Activated == clickTime then
		trip()
		updateButtonText()
	end
end)

TripButton.MouseButton2Click:Connect(function()
	rebindKey("Trip")
end)

FlingButton.MouseButton1Click:Connect(function()
	if not FlingButton:IsDescendantOf(game) then return end
	local clickTime = tick()
	FlingButton.Activated = clickTime
	task.wait(0.01)
	if FlingButton.Activated == clickTime then
		fling()
		if isTripped then
			isTripped = false
			updateButtonText()
		end
	end
end)

FlingButton.MouseButton2Click:Connect(function()
	rebindKey("Fling")
end)

SitButton.MouseEnter:Connect(function()
	SitButton.Text = "LMB: Sit | RMB: Rebind"
end)

SitButton.MouseLeave:Connect(function()
	updateButtonText()
end)

TripButton.MouseEnter:Connect(function()
	if isTripped then
		TripButton.Text = "LMB: Untrip | RMB: Rebind"
	else
		TripButton.Text = "LMB: Trip | RMB: Rebind"
	end
end)

TripButton.MouseLeave:Connect(function()
	updateButtonText()
end)

FlingButton.MouseEnter:Connect(function()
	FlingButton.Text = "LMB: Fling | RMB: Rebind"
end)

FlingButton.MouseLeave:Connect(function()
	updateButtonText()
end)

MinimizeButton.MouseEnter:Connect(function()
	MinimizeButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
end)

MinimizeButton.MouseLeave:Connect(function()
	MinimizeButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
end)

CloseButton.MouseEnter:Connect(function()
	CloseButton.BackgroundColor3 = Color3.fromRGB(220, 80, 80)
end)

CloseButton.MouseLeave:Connect(function()
	CloseButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
end)

RestoreButton.MouseEnter:Connect(function()
	MinimizedFrame.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
end)

RestoreButton.MouseLeave:Connect(function()
	MinimizedFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
end)

local dragging
local dragInput
local dragStart
local startPos

local function updateInput(input)
	local delta = input.Position - dragStart
	MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

DragFrame.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		dragStart = input.Position
		startPos = MainFrame.Position
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)

DragFrame.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
		dragInput = input
	end
end)

UserInputService.InputChanged:Connect(function(input)
	if input == dragInput and dragging then
		updateInput(input)
	end
end)

MinimizedFrame.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		dragStart = input.Position
		startPos = MinimizedFrame.Position
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)

MinimizedFrame.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
		dragInput = input
	end
end)

UserInputService.InputChanged:Connect(function(input)
	if input == dragInput and dragging and MinimizedFrame.Visible then
		local delta = input.Position - dragStart
		MinimizedFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
	end
end)

UserInputService.InputBegan:Connect(function(input, gameProcessed)
	if gameProcessed then return end

	if input.UserInputType == Enum.UserInputType.Keyboard then
		local key = input.KeyCode.Name

		if key == Keybinds.Sit then
			sit()
			local originalColor = SitButton.BackgroundColor3
			SitButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
			task.wait(0.1)
			SitButton.BackgroundColor3 = originalColor

		elseif key == Keybinds.Trip then
			trip()
			updateButtonText()
			local originalColor = TripButton.BackgroundColor3
			TripButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
			task.wait(0.1)
			TripButton.BackgroundColor3 = originalColor

		elseif key == Keybinds.Fling then
			fling()
			if isTripped then
				isTripped = false
				updateButtonText()
			end
			local originalColor = FlingButton.BackgroundColor3
			FlingButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
			task.wait(0.1)
			FlingButton.BackgroundColor3 = originalColor
		end
	end
end)

Player.CharacterAdded:Connect(function(character)
	character:WaitForChild("HumanoidRootPart")
	character:WaitForChild("Humanoid")
	isTripped = false
	updateButtonText()
end)

updateButtonText()